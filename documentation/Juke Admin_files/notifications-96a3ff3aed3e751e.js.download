(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{8200:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/notifications",function(){return n(39313)}])},39313:function(t,e,n){"use strict";n.r(e);var i=n(54011),a=n(14134),o=n(33510),s=n(9551),r=n(89663),c=n(77423),l=n(66586),u=n(44922),d=n(3335),f=n(15281),h=n.n(f),g=n(97458),p=n(94796),N=n(78828),m=n(66220),v=n(64533),E=n(78778),T=n(40645),w=n(46623),k=n(65412),D=function(t){(0,c.Z)(n,t);var e=(0,d.Z)(n);function n(t){var s;return(0,o.Z)(this,n),(s=e.call(this,t)).bulkActions={DELETE:"DELETE"},s.getNotificationList=function(){var t=s.props,e=t.updateSubscriptions,n=t.onErrorCatch,o=s.state,r=o.pageNumber,c=o.pageSize;s.setState({isLoading:!0});var l={pageNumber:r,pageSize:c},u=(0,i.Z)(s);Promise.all([m.mj.getAllNotifications({queryParameters:l,signal:s.signal}),m.mj.getUnreadNotifications({signal:s.signal})]).then((function(t){var n=v.sm.getResultsFromResponse(t[0]),i=v.sm.getPaginationFromResponse(t[0]);if(e({type:k.I$.UPDATE_NOTIFICATION_COUNT,payload:t[1]}),0===n.length)s.setState({isLoading:!1,notifications:[]});else{var a=i.pageNumber,o=i.totalPages;s.setState({isLoading:!1,notifications:n,pageNumber:a,totalPages:o})}})).catch(function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(e);case 2:u.setState({isLoading:!1,notifications:[]});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},s.deleteNotification=function(){var t=s.props.onErrorCatch,e=s.state.activeNotifications;s.setState({isUpdating:!0});var n={ids:e.map((function(t){return t.id}))};m.mj.deleteMultipleNotificationById({queryParameters:n,signal:s.signal}).then((function(){s.getNotificationList()})).catch(t).finally((function(){s.setState({isUpdating:!1,activeNotifications:[],showDeleteModal:!1})}))},s.handleDeleteModal=function(t){t&&t.id?s.setState({showDeleteModal:!0,activeNotifications:[t]}):s.setState({activeNotifications:[],showDeleteModal:!1})},s.handleBulkActionChange=function(t){s.setState(t)},s.handleUpdate=function(){s.getNotificationList()},s.getNotificationAction=function(t){var e=s.props,n=e.router,o=e.onErrorCatch,r=(0,i.Z)(s);return new Promise((function(t){return t(null)})).then((function(){if(t.isRead)return Promise.resolve(null);return m.mj.updateNotificationById({id:t.id,request:{isRead:!0},signal:s.signal})})).then((function(){var e;switch(t.notificationType){case k.GT.NEW_LEAD:case k.GT.NEW_BOOKING:e=k.yy.EVENTS_UPDATE;break;case k.GT.NEW_PAYMENT_AUTHORIZATION:e=k.yy.PAYMENTS_UPDATE;break;case k.GT.NEW_ERROR:e=k.yy.ERRORS_UPDATE;break;default:v.$V.warn("unknown notification type")}e&&n.push(v.cw.getDynamicPath(e,[t.valueOne]))})).catch(function(){var t=(0,a.Z)(h().mark((function t(e){return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(e);case 2:r.setState({isUpdating:!1});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},s.getTableHeaders=function(){return["Is Read?","Date","Notification","View","Delete"]},s.getTableRows=function(){return s.state.notifications.map((function(t){var e=t.id;return{id:e,columns:[(0,g.jsx)(N.lD,{isChecked:t.isRead},e),v.Cv.formatDateTime(v.Cv.formatUtcToLocalTimezone(t.dateCreated)),t.title,(0,g.jsx)(T.Z,{variant:"outline-primary",onClick:function(){return s.getNotificationAction(t)},children:"View"},e),(0,g.jsx)(T.Z,{variant:"outline-danger",onClick:function(){return s.handleDeleteModal(t)},children:"Delete"},e)]}}))},s.handleBulkActionSelect=function(t){var e=s.state,n=e.checkedRows,i=e.notifications;if(v.oL.getInputFromEvent(t).value===s.bulkActions.DELETE)s.setState({showDeleteModal:!0,activeNotifications:i.filter((function(t){return n.includes(t.id)}))});else v.$V.warn("unknown bulk action")},s.getTableBulkActions=function(){return[{id:s.bulkActions.DELETE,value:"Delete Multiple"}]},s.state=(0,u.Z)((0,l.Z)({},p.uG,v.L_.defaultPaginationState),{notifications:[],showDeleteModal:!1,activeNotifications:[],checkedRows:[]}),s}var f=n.prototype;return f.componentDidMount=function(){(0,s.Z)((0,r.Z)(n.prototype),"componentDidMount",this).call(this),this.getNotificationList()},f.render=function(){var t=this.state,e=t.isLoading,n=t.showDeleteModal,i=t.activeNotifications,a=t.isUpdating,o=t.pageNumber,s=t.totalPages,r=t.pageSize;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(w.pV,{title:"Inbox"}),(0,g.jsx)(N.ly,{isLoading:e,children:(0,g.jsx)(N.tQ,{headers:this.getTableHeaders(),rows:this.getTableRows(),pageNumber:o,pageSize:r,totalPages:s,onBulkActionChange:this.handleBulkActionChange,isUpdating:a,bulkActions:this.getTableBulkActions(),onBulkActionSelect:this.handleBulkActionSelect})}),n&&(0,g.jsx)(N.VF,{show:n,body:i.length>1?(0,g.jsxs)("p",{children:["Are you sure you want to delete"," ",(0,g.jsx)("strong",{children:i.length})," notifications?"]}):(0,g.jsxs)("p",{children:["Are you sure you want to delete"," ",(0,g.jsx)("strong",{children:i[0].title})," for"," ",(0,g.jsx)("strong",{children:v.Cv.formatDateTime(v.Cv.formatUtcToLocalTimezone(i[0].dateCreated))}),"?"]}),title:"Delete Notification?",onClick:this.deleteNotification,onClose:this.handleDeleteModal,buttonVariant:"outline-danger",buttonText:"Confirm Delete",isLoading:a})]})},n}(N.H6);e.default=(0,E.withRouter)(D)}},function(t){t.O(0,[9774,2888,179],(function(){return e=8200,t(t.s=e);var e}));var e=t.O();_N_E=e}]);